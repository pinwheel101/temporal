ë§¤ìš° í˜„ì‹¤ì ì¸ ë¬¸ì œì…ë‹ˆë‹¤. ì´ëŸ° ìƒí™©ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë°©ì–´ ì „ëµì„ ì œì•ˆë“œë¦½ë‹ˆë‹¤.

---

## ğŸ›¡ï¸ í•˜ì´ë¸Œë¦¬ë“œ ì™„ë£Œ íŒë‹¨ ì „ëµ

### í•µì‹¬ ì•„ì´ë””ì–´

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    3ì¤‘ ë°©ì–´ ì „ëµ                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   ì™„ë£Œ íŒë‹¨ = ì´ë²¤íŠ¸ ê¸°ë°˜ (Primary)                                     â”‚
â”‚             + ìƒíƒœ ë³€ê²½ ê°ì§€ (Secondary)                                â”‚
â”‚             + Timeout (Fallback)                                        â”‚
â”‚                                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚   â”‚                                                             â”‚       â”‚
â”‚   â”‚   ìš°ì„ ìˆœìœ„ 1: ì¢…ë£Œ ì´ë²¤íŠ¸ ìˆ˜ì‹                               â”‚       â”‚
â”‚   â”‚              â””â”€â–¶ ì¦‰ì‹œ Summary ì¶œë ¥                          â”‚       â”‚
â”‚   â”‚                                                             â”‚       â”‚
â”‚   â”‚   ìš°ì„ ìˆœìœ„ 2: ìƒíƒœ ë³€ê²½ ê°ì§€ (stepId, substId ë³€ê²½)         â”‚       â”‚
â”‚   â”‚              â””â”€â–¶ ì´ì „ Step/Wafer Summary ì¶œë ¥               â”‚       â”‚
â”‚   â”‚                                                             â”‚       â”‚
â”‚   â”‚   ìš°ì„ ìˆœìœ„ 3: Timeout (ì„¤ì • ì‹œê°„ ë™ì•ˆ ë°ì´í„° ì—†ìŒ)          â”‚       â”‚
â”‚   â”‚              â””â”€â–¶ Summary ì¶œë ¥ + ê²½ê³  í”Œë˜ê·¸                 â”‚       â”‚
â”‚   â”‚                                                             â”‚       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ State ìƒíƒœ ë¨¸ì‹  ì„¤ê³„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Step/Wafer ìƒíƒœ ë¨¸ì‹                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚                        â”‚   UNKNOWN   â”‚  (ì´ˆê¸° ìƒíƒœ)                     â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚                               â”‚                                         â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚              â”‚                â”‚                â”‚                        â”‚
â”‚              â–¼                â–¼                â–¼                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚   â”‚ START_RECEIVED  â”‚ â”‚  RUNNING    â”‚ â”‚  END_RECEIVED   â”‚               â”‚
â”‚   â”‚                 â”‚ â”‚ (ë°ì´í„°ë§Œ)  â”‚ â”‚  (ì¢…ë£Œë§Œ ìˆ˜ì‹ )  â”‚               â”‚
â”‚   â”‚ ì‹œì‘ ì´ë²¤íŠ¸ O   â”‚ â”‚             â”‚ â”‚                 â”‚               â”‚
â”‚   â”‚ ë°ì´í„° X        â”‚ â”‚ ì‹œì‘ X      â”‚ â”‚  ì‹œì‘ X         â”‚               â”‚
â”‚   â”‚ ì¢…ë£Œ X          â”‚ â”‚ ì¢…ë£Œ X      â”‚ â”‚  ë°ì´í„° X       â”‚               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚            â”‚                 â”‚                 â”‚                        â”‚
â”‚            â”‚    ë°ì´í„° ìˆ˜ì‹   â”‚                 â”‚                        â”‚
â”‚            â–¼                 â–¼                 â–¼                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚   â”‚                      ACTIVE                         â”‚               â”‚
â”‚   â”‚                                                     â”‚               â”‚
â”‚   â”‚   ì‹œì‘ ì´ë²¤íŠ¸: O ë˜ëŠ” X (flagë¡œ ê¸°ë¡)               â”‚               â”‚
â”‚   â”‚   ë°ì´í„°: ìˆ˜ì‹  ì¤‘                                   â”‚               â”‚
â”‚   â”‚   ì¢…ë£Œ ì´ë²¤íŠ¸: ëŒ€ê¸° ì¤‘                              â”‚               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                             â”‚                                           â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚        â”‚                    â”‚                    â”‚                      â”‚
â”‚        â–¼                    â–¼                    â–¼                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚   â”‚COMPLETEDâ”‚       â”‚STATE_CHANGED â”‚      â”‚ TIMEOUT   â”‚                 â”‚
â”‚   â”‚(ì •ìƒ)   â”‚       â”‚(ìƒíƒœë³€ê²½ê°ì§€)â”‚      â”‚ (Fallback)â”‚                 â”‚
â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚        â”‚                   â”‚                    â”‚                       â”‚
â”‚        â–¼                   â–¼                    â–¼                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚   â”‚                  OUTPUT SUMMARY                     â”‚               â”‚
â”‚   â”‚                                                     â”‚               â”‚
â”‚   â”‚   + completionType: EVENT / STATE_CHANGE / TIMEOUT â”‚               â”‚
â”‚   â”‚   + hasStartEvent: true/false                       â”‚               â”‚
â”‚   â”‚   + hasEndEvent: true/false                         â”‚               â”‚
â”‚   â”‚   + dataCount: N                                    â”‚               â”‚
â”‚   â”‚   + warnings: [...]                                 â”‚               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ êµ¬í˜„ ì„¤ê³„

### State êµ¬ì¡°

```java
public class StepWaferState {
    // ì‹ë³„ ì •ë³´
    String groupKey;           // fab+eqpId+lotCd+...
    String stepId;
    String substId;
    
    // ì´ë²¤íŠ¸ ìˆ˜ì‹  í”Œë˜ê·¸
    boolean startEventReceived;
    boolean endEventReceived;
    
    // íƒ€ì„ìŠ¤íƒ¬í”„
    Long startEventTime;       // ì‹œì‘ ì´ë²¤íŠ¸ ì‹œê°„
    Long firstDataTime;        // ì²« ë°ì´í„° ìˆ˜ì‹  ì‹œê°„
    Long lastDataTime;         // ë§ˆì§€ë§‰ ë°ì´í„° ìˆ˜ì‹  ì‹œê°„
    Long endEventTime;         // ì¢…ë£Œ ì´ë²¤íŠ¸ ì‹œê°„
    
    // ì§‘ê³„ ë°ì´í„°
    Map<String, StatisticsAccumulator> parameterStats;
    // StatisticsAccumulator: count, sum, sumSquares, min, max
    
    // ë°ì´í„° í’ˆì§ˆ
    long dataCount;
    List<String> warnings;
}
```

### Summary ì¶œë ¥ êµ¬ì¡°

```java
public class StepWaferSummary {
    // ê·¸ë£¹ í‚¤
    String fab, eqpId, lotCd, fdcChambId, recipeId, statCd, stepId, substId;
    
    // ì§‘ê³„ ê²°ê³¼
    Map<String, ParameterSummary> parameters;
    // ParameterSummary: min, max, avg, stddev, count
    
    // ë©”íƒ€ ì •ë³´
    String completionType;     // "EVENT" | "STATE_CHANGE" | "TIMEOUT"
    boolean hasStartEvent;
    boolean hasEndEvent;
    long dataCount;
    
    // ì‹œê°„ ì •ë³´
    Timestamp startTime;
    Timestamp endTime;
    long durationMs;
    
    // ë°ì´í„° í’ˆì§ˆ í”Œë˜ê·¸
    List<String> warnings;
    // ì˜ˆ: ["MISSING_START_EVENT", "TIMEOUT_TRIGGERED", "LOW_DATA_COUNT"]
}
```

---

## ğŸ”„ ì²˜ë¦¬ ë¡œì§ (Pseudo Code)

```java
public class StepWaferSummaryFunction 
    extends KeyedProcessFunction<String, TraceFlat, StepWaferSummary> {
    
    // State
    private ValueState<StepWaferState> state;
    
    // ì„¤ì •ê°’
    private static final long TIMEOUT_MS = 30 * 60 * 1000; // 30ë¶„ (ì¡°ì • ê°€ëŠ¥)
    private static final long MIN_DATA_COUNT = 10;          // ìµœì†Œ ë°ì´í„° ìˆ˜
    
    @Override
    public void processElement(TraceFlat event, Context ctx, Collector<StepWaferSummary> out) {
        StepWaferState current = state.value();
        if (current == null) {
            current = new StepWaferState();
            current.groupKey = extractGroupKey(event);
        }
        
        // 1. ì´ë²¤íŠ¸ íƒ€ì… íŒë³„
        EventType eventType = determineEventType(event);
        
        switch (eventType) {
            case START_EVENT:
                handleStartEvent(current, event, ctx);
                break;
                
            case END_EVENT:
                handleEndEvent(current, event, ctx, out);
                break;
                
            case DATA:
                handleDataEvent(current, event, ctx, out);
                break;
        }
        
        state.update(current);
    }
    
    private void handleStartEvent(StepWaferState state, TraceFlat event, Context ctx) {
        // ì‹œì‘ ì´ë²¤íŠ¸ ì²˜ë¦¬
        state.startEventReceived = true;
        state.startEventTime = event.getEventTimestamp();
        
        // Timeout íƒ€ì´ë¨¸ ë“±ë¡
        ctx.timerService().registerEventTimeTimer(
            event.getEventTimestamp() + TIMEOUT_MS
        );
    }
    
    private void handleEndEvent(StepWaferState state, TraceFlat event, 
                                Context ctx, Collector<StepWaferSummary> out) {
        // ì¢…ë£Œ ì´ë²¤íŠ¸ ì²˜ë¦¬
        state.endEventReceived = true;
        state.endEventTime = event.getEventTimestamp();
        
        // Summary ì¶œë ¥
        emitSummary(state, "EVENT", out);
        
        // State í´ë¦¬ì–´ ë° íƒ€ì´ë¨¸ ì·¨ì†Œ
        clearStateAndTimers(state, ctx);
    }
    
    private void handleDataEvent(StepWaferState state, TraceFlat event,
                                 Context ctx, Collector<StepWaferSummary> out) {
        
        // 2. ìƒíƒœ ë³€ê²½ ê°ì§€ (Step/Wafer ë³€ê²½)
        if (isStateChanged(state, event)) {
            // ì´ì „ ìƒíƒœì˜ Summary ì¶œë ¥
            emitSummary(state, "STATE_CHANGE", out);
            
            // ìƒˆë¡œìš´ State ì‹œì‘
            state = resetForNewState(event);
            
            // ê²½ê³ : ì´ì „ ìƒíƒœì— ì¢…ë£Œ ì´ë²¤íŠ¸ ì—†ì—ˆìŒ
            if (!state.endEventReceived) {
                state.warnings.add("PREVIOUS_MISSING_END_EVENT");
            }
        }
        
        // 3. ë°ì´í„° ì§‘ê³„
        updateStatistics(state, event);
        
        // ì²« ë°ì´í„°ì¸ ê²½ìš°
        if (state.firstDataTime == null) {
            state.firstDataTime = event.getEventTimestamp();
            
            // ì‹œì‘ ì´ë²¤íŠ¸ ì—†ì´ ë°ì´í„°ê°€ ë¨¼ì € ì˜¨ ê²½ìš°
            if (!state.startEventReceived) {
                state.warnings.add("MISSING_START_EVENT");
                // Timeout íƒ€ì´ë¨¸ ë“±ë¡ (ì‹œì‘ ì´ë²¤íŠ¸ ê¸°ì¤€ì´ ì•„ë‹Œ ì²« ë°ì´í„° ê¸°ì¤€)
                ctx.timerService().registerEventTimeTimer(
                    event.getEventTimestamp() + TIMEOUT_MS
                );
            }
        }
        
        state.lastDataTime = event.getEventTimestamp();
        state.dataCount++;
    }
    
    @Override
    public void onTimer(long timestamp, OnTimerContext ctx, 
                       Collector<StepWaferSummary> out) {
        StepWaferState current = state.value();
        
        if (current != null && current.dataCount > 0) {
            // Timeoutìœ¼ë¡œ ì¸í•œ Summary ì¶œë ¥
            current.warnings.add("TIMEOUT_TRIGGERED");
            
            if (!current.endEventReceived) {
                current.warnings.add("MISSING_END_EVENT");
            }
            
            emitSummary(current, "TIMEOUT", out);
            state.clear();
        }
    }
    
    private void emitSummary(StepWaferState state, String completionType,
                            Collector<StepWaferSummary> out) {
        StepWaferSummary summary = new StepWaferSummary();
        
        // ê¸°ë³¸ ì •ë³´ ì„¤ì •
        summary.completionType = completionType;
        summary.hasStartEvent = state.startEventReceived;
        summary.hasEndEvent = state.endEventReceived;
        summary.dataCount = state.dataCount;
        summary.warnings = new ArrayList<>(state.warnings);
        
        // ë°ì´í„° í’ˆì§ˆ ê²€ì¦
        if (state.dataCount < MIN_DATA_COUNT) {
            summary.warnings.add("LOW_DATA_COUNT:" + state.dataCount);
        }
        
        // í†µê³„ ê³„ì‚°
        summary.parameters = calculateStatistics(state.parameterStats);
        
        // ì‹œê°„ ì •ë³´
        summary.startTime = determineStartTime(state);
        summary.endTime = determineEndTime(state);
        summary.durationMs = summary.endTime - summary.startTime;
        
        out.collect(summary);
    }
}
```

---

## ğŸ“Š ì´ìƒ ì¼€ì´ìŠ¤ ì²˜ë¦¬ ë§¤íŠ¸ë¦­ìŠ¤

| ì‹œì‘ ì´ë²¤íŠ¸ | ë°ì´í„° | ì¢…ë£Œ ì´ë²¤íŠ¸ | ì²˜ë¦¬ ë°©ì‹ | Warning |
|------------|--------|------------|----------|---------|
| âœ… | âœ… | âœ… | ì •ìƒ ì¶œë ¥ (EVENT) | ì—†ìŒ |
| âœ… | âœ… | âŒ | Timeout ë˜ëŠ” ìƒíƒœë³€ê²½ | `MISSING_END_EVENT` |
| âŒ | âœ… | âœ… | ì •ìƒ ì¶œë ¥ (EVENT) | `MISSING_START_EVENT` |
| âŒ | âœ… | âŒ | Timeout ë˜ëŠ” ìƒíƒœë³€ê²½ | `MISSING_START_EVENT`, `MISSING_END_EVENT` |
| âœ… | âŒ | âœ… | ì¶œë ¥ ìŠ¤í‚µ ë˜ëŠ” ë¹ˆ Summary | `NO_DATA` |
| âœ… | âŒ | âŒ | Timeout í›„ ìŠ¤í‚µ | `NO_DATA`, `MISSING_END_EVENT` |
| âŒ | âŒ | âœ… | ì¢…ë£Œ ì´ë²¤íŠ¸ ë¬´ì‹œ | `ORPHAN_END_EVENT` (ë¡œê·¸ë§Œ) |

---

## ğŸ“ˆ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ ì„¤ê³„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Summary ë°ì´í„° í’ˆì§ˆ ëª¨ë‹ˆí„°ë§                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   ì‹¤ì‹œê°„ ë©”íŠ¸ë¦­:                                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚   â”‚                                                             â”‚       â”‚
â”‚   â”‚   completionType ë¶„í¬ (ìµœê·¼ 1ì‹œê°„)                          â”‚       â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚       â”‚
â”‚   â”‚   â”‚ EVENT        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 85%   â”‚           â”‚       â”‚
â”‚   â”‚   â”‚ STATE_CHANGE â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 10%                   â”‚           â”‚       â”‚
â”‚   â”‚   â”‚ TIMEOUT      â–ˆâ–ˆâ–ˆ 5%                         â”‚ â—€â”€ 5% ì´ˆê³¼ì‹œ ì•ŒëŒâ”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚       â”‚
â”‚   â”‚                                                             â”‚       â”‚
â”‚   â”‚   ì´ë²¤íŠ¸ ëˆ„ë½ë¥  (ìµœê·¼ 1ì‹œê°„)                                â”‚       â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚       â”‚
â”‚   â”‚   â”‚ MISSING_START_EVENT  â–ˆâ–ˆ 3%                  â”‚           â”‚       â”‚
â”‚   â”‚   â”‚ MISSING_END_EVENT    â–ˆâ–ˆâ–ˆ 7%                 â”‚ â—€â”€ 10% ì´ˆê³¼ì‹œ ì•ŒëŒâ”‚
â”‚   â”‚   â”‚ BOTH_MISSING         â–ˆ 1%                   â”‚           â”‚       â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚       â”‚
â”‚   â”‚                                                             â”‚       â”‚
â”‚   â”‚   ì¥ë¹„ë³„ ì´ìƒ ì¼€ì´ìŠ¤                                        â”‚       â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚       â”‚
â”‚   â”‚   â”‚ EQP_ID      â”‚ TIMEOUT% â”‚ MISSING% â”‚ STATUS  â”‚           â”‚       â”‚
â”‚   â”‚   â”‚ 6DGP4212    â”‚ 2%       â”‚ 5%       â”‚ âœ… OK   â”‚           â”‚       â”‚
â”‚   â”‚   â”‚ 6DGP4215    â”‚ 15%      â”‚ 25%      â”‚ âš ï¸ WARN â”‚           â”‚       â”‚
â”‚   â”‚   â”‚ 6DGP4218    â”‚ 45%      â”‚ 60%      â”‚ ğŸ”´ ALERTâ”‚           â”‚       â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚       â”‚
â”‚   â”‚                                                             â”‚       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                         â”‚
â”‚   ì•ŒëŒ ê·œì¹™:                                                            â”‚
â”‚   - TIMEOUT ë¹„ìœ¨ > 10% â†’ Warning                                        â”‚
â”‚   - TIMEOUT ë¹„ìœ¨ > 30% â†’ Critical (Oracle íŒ€ í™•ì¸ ìš”ì²­)                 â”‚
â”‚   - íŠ¹ì • ì¥ë¹„ MISSING > 50% â†’ í•´ë‹¹ ì¥ë¹„ ì ê²€ ìš”ì²­                       â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—„ï¸ Summary í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ (í’ˆì§ˆ ì»¬ëŸ¼ í¬í•¨)

```sql
CREATE TABLE trace_summary (
    -- ê·¸ë£¹ í‚¤
    fab STRING,
    eqp_id STRING,
    slot_no STRING,
    lot_cd STRING,
    fdc_chamb_id STRING,
    recipe_id STRING,
    stat_cd STRING,
    step_id STRING,
    subst_id STRING,
    
    -- ì‹œê°„ ì •ë³´
    start_time TIMESTAMP,
    end_time TIMESTAMP,
    duration_ms BIGINT,
    
    -- ì§‘ê³„ ê²°ê³¼ (ë°°ì—´ ë˜ëŠ” MAP)
    param_names ARRAY<STRING>,
    param_min ARRAY<DOUBLE>,
    param_max ARRAY<DOUBLE>,
    param_avg ARRAY<DOUBLE>,
    param_stddev ARRAY<DOUBLE>,
    param_count ARRAY<BIGINT>,
    
    -- ë°ì´í„° í’ˆì§ˆ ë©”íƒ€
    completion_type STRING,      -- 'EVENT', 'STATE_CHANGE', 'TIMEOUT'
    has_start_event BOOLEAN,
    has_end_event BOOLEAN,
    data_count BIGINT,
    warnings ARRAY<STRING>,
    
    -- íŒŒí‹°ì…˜
    event_date DATE
)
PARTITIONED BY (event_date);
```

---

## âœ… ìµœì¢… ê¶Œì¥ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ìµœì¢… ê¶Œì¥ ì•„í‚¤í…ì²˜                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   Oracle íŒ€ ìš”ì²­ì‚¬í•­:                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚   â”‚ 1. trace_raw í˜•íƒœë¡œ Kafka Topic Aì— ì ì¬                    â”‚       â”‚
â”‚   â”‚ 2. Step/Wafer ì‹œì‘/ì¢…ë£Œ ì´ë²¤íŠ¸ë¥¼ Kafka Topic Bì— ì ì¬       â”‚       â”‚
â”‚   â”‚    (ê°€ëŠ¥í•˜ë‹¤ë©´, ìµœì„ ì˜ ë…¸ë ¥ìœ¼ë¡œ)                            â”‚       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                         â”‚
â”‚   Kafka Topics:                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚   â”‚   Topic A    â”‚    â”‚   Topic B    â”‚                                  â”‚
â”‚   â”‚ (trace_raw)  â”‚    â”‚  (events)    â”‚                                  â”‚
â”‚   â”‚ 1,000 msg/s  â”‚    â”‚  ~100 msg/s  â”‚                                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚          â”‚                   â”‚                                          â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚                    â”‚                                                    â”‚
â”‚                    â–¼                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚   â”‚                    Flink Job                                â”‚       â”‚
â”‚   â”‚                                                             â”‚       â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚       â”‚
â”‚   â”‚   â”‚ Source A    â”‚     â”‚ Source B    â”‚                       â”‚       â”‚
â”‚   â”‚   â”‚ (trace_raw) â”‚     â”‚ (events)    â”‚                       â”‚       â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                       â”‚       â”‚
â”‚   â”‚          â”‚                   â”‚                              â”‚       â”‚
â”‚   â”‚          â–¼                   â”‚                              â”‚       â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚                              â”‚       â”‚
â”‚   â”‚   â”‚  flatMap()  â”‚            â”‚                              â”‚       â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜            â”‚                              â”‚       â”‚
â”‚   â”‚          â”‚                   â”‚                              â”‚       â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚       â”‚
â”‚   â”‚   â”‚             â”‚            â”‚                              â”‚       â”‚
â”‚   â”‚   â–¼             â–¼            â–¼                              â”‚       â”‚
â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚       â”‚
â”‚   â”‚ â”‚ map â”‚    â”‚  sink   â”‚  â”‚ connect() + keyBy   â”‚             â”‚       â”‚
â”‚   â”‚ â””â”€â”€â”¬â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â”‚ + CoProcessFunction â”‚             â”‚       â”‚
â”‚   â”‚    â”‚            â”‚       â”‚ (3ì¤‘ ë°©ì–´ ë¡œì§)     â”‚             â”‚       â”‚
â”‚   â”‚    â–¼            â–¼       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚       â”‚
â”‚   â”‚ trace_log  trace_flat             â”‚                         â”‚       â”‚
â”‚   â”‚                                    â–¼                         â”‚       â”‚
â”‚   â”‚                               summary                        â”‚       â”‚
â”‚   â”‚                          (with quality flags)                â”‚       â”‚
â”‚   â”‚                                                             â”‚       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ ìš”ì•½

| í•­ëª© | ê¶Œì¥ ì‚¬í•­ |
|------|----------|
| **Kafka ë°ì´í„°** | trace_raw (ë³€ê²½ ì—†ìŒ) |
| **ì¶”ê°€ ìš”ì²­** | Step/Wafer ì‹œì‘/ì¢…ë£Œ ì´ë²¤íŠ¸ Topic (best effort) |
| **ì™„ë£Œ íŒë‹¨** | 3ì¤‘ ë°©ì–´ (ì´ë²¤íŠ¸ â†’ ìƒíƒœë³€ê²½ â†’ Timeout) |
| **ë°ì´í„° í’ˆì§ˆ** | completionType, warnings ì»¬ëŸ¼ìœ¼ë¡œ ì¶”ì  |
| **ëª¨ë‹ˆí„°ë§** | ì´ìƒ ì¼€ì´ìŠ¤ ë¹„ìœ¨ ëŒ€ì‹œë³´ë“œ + ì•ŒëŒ |
| **Timeout ì„¤ì •** | ì´ˆê¸° 30ë¶„, ì‹¤ì œ ë°ì´í„° ë³´ê³  ì¡°ì • |

ì´ ë°©ì‹ì´ë©´ **Oracle íŒ€ì˜ ì´ë²¤íŠ¸ ë°œí–‰ì´ ë¶ˆì™„ì „í•˜ë”ë¼ë„** ë°ì´í„° ìœ ì‹¤ ì—†ì´ ì²˜ë¦¬í•  ìˆ˜ ìˆê³ , **í’ˆì§ˆ ë¬¸ì œë¥¼ ì¶”ì í•˜ê³  ê°œì„ **í•  ìˆ˜ ìˆëŠ” ê¸°ë°˜ì´ ë©ë‹ˆë‹¤.
