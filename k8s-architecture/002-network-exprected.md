좋은 질문입니다! 각 항목별로 "BGP 구성에 문제없는 답변"과 "문제가 될 수 있는 답변"을 정리해드릴게요.

---

## 1. BGP 피어링 관련

| 질문 | 문제없는 답변 | 문제가 될 수 있는 답변 |
|------|---------------|------------------------|
| 서버 ↔ ToR 스위치 간 BGP 피어링 가능 여부 | "가능합니다" 또는 "eBGP 피어링 설정해드릴 수 있습니다" | "BGP는 스위치 간에만 사용합니다", "서버와 피어링은 정책상 불가합니다" |
| 클러스터용 Private ASN 할당 | "64512-65534 중 하나 할당 가능합니다" 또는 구체적인 ASN 번호 제시 | "ASN은 네트워크 장비에만 할당합니다", "승인 절차가 복잡합니다" |
| ToR 스위치의 ASN | 구체적인 ASN 번호 (예: "65001입니다") | "확인이 어렵습니다", "공유 불가합니다" |
| BFD 지원 여부 | "지원됩니다", "활성화 가능합니다" | "지원 안 됩니다" → 치명적이진 않음, 장애 감지가 느려질 뿐 (3초 → 90초) |

**BFD가 없어도 BGP 구성은 가능**합니다. 다만 노드 장애 시 failover 시간이 길어집니다 (BFD 있으면 ~1초, 없으면 ~90초).

---

## 2. 네트워크 토폴로지 관련

| 질문 | 문제없는 답변 | 문제가 될 수 있는 답변 |
|------|---------------|------------------------|
| Spine-Leaf 구조 확인 | "네, Spine-Leaf 구조입니다" | "3-Tier 구조입니다" → BGP 가능하나 설계가 복잡해짐 |
| ECMP 활성화 여부 | "활성화되어 있습니다", "maximum-paths 설정되어 있습니다" | "ECMP 사용 안 합니다" → Active-Active 로드밸런싱 불가, 단일 경로만 사용 |
| 서버 NIC 연결 계획 | "ToR 2대에 각각 연결 (듀얼 호밍)", "액티브-액티브 본딩 가능" | "단일 ToR에만 연결" → 단일 장애점 발생 |
| 관리망/서비스망 분리 | "VLAN으로 분리되어 있습니다", "별도 서브넷 사용" | "분리 안 되어 있습니다" → BGP와 무관하나 운영상 권장됨 |

**ECMP가 핵심**입니다. ECMP가 없으면 여러 노드가 같은 VIP를 광고해도 하나의 경로만 사용되어 로드밸런싱 효과가 없습니다.

---

## 3. IP 대역 관련

| 질문 | 문제없는 답변 | 문제가 될 수 있는 답변 |
|------|---------------|------------------------|
| API Server VIP | "할당 가능합니다" + IP 주소 제시 | "IP 부족합니다" → VIP 없이는 HA 구성 어려움 |
| Service LoadBalancer IP 대역 | "/24 이상 할당 가능합니다" (256개 IP) | "/28만 가능합니다" (16개) → 서비스 수 제한됨, 협의 필요 |
| Pod 네트워크 CIDR | "오버레이 사용해도 됩니다" 또는 "별도 대역 할당 가능합니다" | 둘 다 가능, 선택의 문제 |
| 노드 IP 대역 | "190대용 대역 준비되어 있습니다" (최소 /24) | "IP가 부족합니다" → 근본적 문제, 협의 필요 |

**Pod CIDR 관련 추가 설명**
- "오버레이 사용" → Cilium VXLAN 모드, 물리 네트워크 변경 불필요
- "별도 대역 할당" → Cilium Native Routing 모드, 성능 우수하나 네트워크팀 협업 필요

---

## 4. 방화벽/보안 관련

| 질문 | 문제없는 답변 | 문제가 될 수 있는 답변 |
|------|---------------|------------------------|
| 노드 간 통신 방화벽 | "클러스터 대역 내 통신은 제약 없습니다" | "포트별 승인 필요합니다" → 쿠버네티스 필요 포트 목록 전달 후 오픈 요청 필요 |
| 외부 클러스터 통신 | "라우팅 가능합니다", "방화벽 오픈 절차 있습니다" | "망 분리되어 있습니다" → MinIO/Iceberg 연동에 별도 협의 필요 |

---

## 핵심 체크리스트 (Yes/No)

BGP 기반 구성을 위한 최소 요구사항입니다:

| # | 항목 | 필수 여부 |
|---|------|-----------|
| 1 | 서버 ↔ ToR BGP 피어링 가능 | **필수** |
| 2 | Private ASN 할당 가능 | **필수** |
| 3 | ToR ASN 정보 제공 | **필수** |
| 4 | ECMP 활성화 | **강력 권장** (없으면 Active-Standby로 제한) |
| 5 | BFD 지원 | 권장 (없어도 동작) |
| 6 | API VIP용 IP 할당 | **필수** |
| 7 | LoadBalancer IP 대역 할당 | **필수** |

---

## 만약 BGP가 불가능하다면?

네트워크팀에서 서버와의 BGP 피어링이 정책상 불가하다고 하면, 대안은 다음과 같습니다:

| 대안 | 설명 |
|------|------|
| **HAProxy + Keepalived** | 별도 서버 2대에 구성, L2 VIP 사용 |
| **kube-vip ARP 모드** | 컨트롤 플레인에서 L2 ARP로 VIP 관리, 동일 L2 도메인 필요 |
| **외부 LB 장비** | F5 등 기존 로드밸런서 활용 |

하지만 Cilium 자체도 BGP로 Service IP를 광고하는 것이 가장 효율적이므로, 가능하면 **BGP 피어링을 승인받는 것을 권장**합니다.

---

네트워크팀 답변을 받으시면 공유해주세요. 답변 내용에 따라 최적의 구성을 안내해드리겠습니다!
